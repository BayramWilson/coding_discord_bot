<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Python Coding Challenge Editor</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        #editor {
            height: 40vh;
            border: 1px solid #ddd;
            margin-top: 20px;
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.34.0/min/vs/loader.min.js"></script>
</head>
<body>

<div class="container">
    <h1 class="mt-4">Python Coding Challenge Editor</h1>

    <div class="form-group mb-3">
        <label for="themeSelect">Theme ausw√§hlen:</label>
        <select class="form-select" id="themeSelect">
            <option value="vs-light">Light</option>
            <option value="vs-dark">Dark</option>
            <option value="dracula">Dracula</option>
            <option value="solarized-light">Solarized Light</option>
            <option value="solarized-dark">Solarized Dark</option>
            <option value="github-dark">GitHub Dark</option>
            <option value="monokai">Monokai</option>
        </select>
    </div>

    <div id="editor"></div>

    <div class="d-flex gap-3 mt-3">
        <button class="btn btn-success" onclick="runCode()">‚ñ∂ Code ausf√ºhren</button>
    </div>

    <div id="output" class="mt-3 p-3 bg-dark text-light" style="min-height: 150px; white-space: pre-wrap;">
        <strong>üîß Ausgabe:</strong><br>
        <span id="output-text">...</span>
    </div>

    <form action="/submit" method="POST" onsubmit="return sendCode();">
        <input type="hidden" name="code" id="code">
        <button type="submit" class="btn btn-primary mt-3">Code absenden</button>
    </form>

    <footer class="text-center mt-5 mb-4 text-muted" style="font-size: 0.9rem;">
        <p>
            Teile dieses Editors basieren auf dem Beitrag von
            <a href="https://codingshiksha.com/javascript/build-a-vscode-coding-ide-with-syntax-highlighting-using-monaco-editor-in-browser-using-js/" target="_blank" rel="noopener noreferrer">
                codingshiksha.com
            </a>
            von <strong>geekygautam1997</strong>
        </p>
    </footer>
</div>

<script>
    let editor;

    require.config({ paths: { 'vs': 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.34.0/min/vs' } });

    require(['vs/editor/editor.main'], function () {
        editor = monaco.editor.create(document.getElementById('editor'), {
            value: [
                '# Schreibe deine Funktion hier:',
                'def ist_gerade(zahl):',
                '    return zahl % 2 == 0'
            ].join('\n'),
            language: 'python',
            theme: 'vs-light',
            fontSize: 14,
            minimap: { enabled: false },
            automaticLayout: true
        });

        // Theme: Custom definitions
        monaco.editor.defineTheme('dracula', {
            base: 'vs-dark',
            inherit: true,
            rules: [
                { token: '', background: '282a36', foreground: 'f8f8f2' },
                { token: 'comment', foreground: '6272a4' },
                { token: 'keyword', foreground: 'ff79c6' },
                { token: 'string', foreground: 'f1fa8c' }
            ],
            colors: { 'editor.background': '#282a36' }
        });

        monaco.editor.defineTheme('solarized-light', {
            base: 'vs',
            inherit: true,
            rules: [
                { token: '', foreground: '586e75', background: 'fdf6e3' },
                { token: 'comment', foreground: '93a1a1' },
                { token: 'keyword', foreground: '859900' },
                { token: 'string', foreground: '2aa198' }
            ],
            colors: { 'editor.background': '#fdf6e3' }
        });

        monaco.editor.defineTheme('solarized-dark', {
            base: 'vs-dark',
            inherit: true,
            rules: [
                { token: '', foreground: '839496', background: '002b36' },
                { token: 'comment', foreground: '586e75' },
                { token: 'keyword', foreground: 'cb4b16' },
                { token: 'string', foreground: '2aa198' }
            ],
            colors: { 'editor.background': '#002b36' }
        });

        monaco.editor.defineTheme('github-dark', {
            base: 'vs-dark',
            inherit: true,
            rules: [
                { token: '', foreground: 'c9d1d9', background: '0d1117' },
                { token: 'comment', foreground: '8b949e' },
                { token: 'keyword', foreground: 'ff7b72' },
                { token: 'string', foreground: 'a5d6ff' }
            ],
            colors: { 'editor.background': '#0d1117' }
        });

        monaco.editor.defineTheme('monokai', {
            base: 'vs-dark',
            inherit: true,
            rules: [
                { token: '', foreground: 'f8f8f2', background: '272822' },
                { token: 'comment', foreground: '75715e' },
                { token: 'keyword', foreground: 'f92672' },
                { token: 'string', foreground: 'a6e22e' }
            ],
            colors: { 'editor.background': '#272822' }
        });

        document.getElementById('themeSelect').addEventListener('change', function () {
            const newTheme = this.value;
            monaco.editor.setTheme(newTheme);
        });
    });

    function runCode() {
        const code = editor.getValue();

        fetch("/run", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ code: code })
        })
        .then(response => response.json())
        .then(data => {
            document.getElementById("output-text").textContent = data.output;
        })
        .catch(err => {
            document.getElementById("output-text").textContent = "‚ùå Fehler beim Ausf√ºhren.";
            console.error(err);
        });
    }

    function sendCode() {
        const code = editor.getValue();
        document.getElementById("code").value = code;
        return true;
    }
</script>

</body>
</html>
